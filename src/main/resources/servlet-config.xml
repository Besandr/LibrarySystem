<?xml version="1.0" encoding="UTF-8" ?>

<!--File with configuration of ActionServlet-->

<servlet-config>
    <!--
    <forms> tag contains forms which is needed for corresponding
    bound by name actions. Tags <formName> for mapping to action and
    <type> of Form class are mandatory
    -->
    <forms>
        <form>
            <name>bookSearchForm</name>
            <type>com.library.web.controller.forms.BookSearchForm</type>
        </form>
        <form>
            <name>OrderBookForm</name>
            <type>com.library.web.controller.forms.OrderBookForm</type>
        </form>
        <form>
            <name>userLoginForm</name>
            <type>com.library.web.controller.forms.UserLoginForm</type>
        </form>
        <form>
            <name>userRegistrationForm</name>
            <type>com.library.web.controller.forms.UserRegistrationForm</type>
        </form>
        <form>
            <name>approveLoanForm</name>
            <type>com.library.web.controller.forms.ApproveLoanForm</type>
        </form>
        <form>
            <name>activeBookLoansForm</name>
            <type>com.library.web.controller.forms.ActiveBookLoansForm</type>
        </form>
    </forms>

    <!--
    Contains mappings to action depending on request path. Also may contains
     mapping to form and action's dependencies.
     <path> - URL path to action. Mandatory
     <type> - full qualified name of Action class. Mandatory
     <form-name> - mapped name of Form in group <forms>
     <dependency> - action's service dependency need to be injected. Optional
        <class> - full qualified name of Service class. Mandatory if dependency exists
        <name> - name of local Action's variable which need to be initialized by
        Service object value. Mandatory if dependency exists
     <validate> - true if Action needed html-form data. Optional
     <formName> - mapping to form. Optional
     <input> - URL path to html-form. Optional
     -->
    <action-mappings>
        <action>
            <path>/</path>
            <type>com.library.web.controller.actions.ShowTitlePageAction</type>
        </action>
        <action>
            <path>/bookSearch</path>
            <type>com.library.web.controller.actions.ShowBookSearchPageAction</type>
            <service-dependencies>
                <dependency>
                    <class>com.library.services.BookService</class>
                    <name>bookService</name>
                </dependency>
            </service-dependencies>
        </action>
        <action>
            <path>/bookSearch.do</path>
            <type>com.library.web.controller.actions.BookSearchAction</type>
            <form-name>bookSearchForm</form-name>
            <validate>true</validate>
            <input>/WEB-INF/jsp/bookSearch.jsp</input>
            <service-dependencies>
                <dependency>
                    <class>com.library.services.BookService</class>
                    <name>bookService</name>
                </dependency>
            </service-dependencies>
        </action>
        <action>
            <path>/user/orderBook.do</path>
            <type>com.library.web.controller.actions.OrderBookAction</type>
            <form-name>OrderBookForm</form-name>
            <validate>true</validate>
            <input>/WEB-INF/jsp/bookSearch.jsp</input>
            <service-dependencies>
                <dependency>
                    <class>com.library.services.LoanService</class>
                    <name>loanService</name>
                </dependency>
            </service-dependencies>
        </action>
        <action>
            <path>/login</path>
            <type>com.library.web.controller.actions.ShowLoginPageAction</type>
        </action>
        <action>
            <path>/login.do</path>
            <type>com.library.web.controller.actions.LoginAction</type>
            <form-name>userLoginForm</form-name>
            <validate>true</validate>
            <input>/WEB-INF/jsp/login.jsp</input>
            <service-dependencies>
                <dependency>
                    <class>com.library.services.UserService</class>
                    <name>userService</name>
                </dependency>
            </service-dependencies>
        </action>
        <action>
            <path>/logout</path>
            <type>com.library.web.controller.actions.LogoutAction</type>
        </action>
        <action>
            <path>/registration</path>
            <type>com.library.web.controller.actions.ShowUserRegistrationPageAction</type>
        </action>
        <action>
            <path>/register.do</path>
            <type>com.library.web.controller.actions.RegisterUserAction</type>
            <form-name>userRegistrationForm</form-name>
            <validate>true</validate>
            <input>/WEB-INF/jsp/registration.jsp</input>
            <service-dependencies>
                <dependency>
                    <class>com.library.services.UserService</class>
                    <name>userService</name>
                </dependency>
            </service-dependencies>
        </action>
        <action>
            <path>/title</path>
            <type>com.library.web.controller.actions.ShowTitlePageAction</type>
        </action>
        <action>
            <path>/cabinet</path>
            <type>com.library.web.controller.actions.ShowPersonalCabinetAction</type>
        </action>
        <action>
            <path>/admin/unapprovedLoans</path>
            <type>com.library.web.controller.actions.ShowUnapprovedLoansAction</type>
            <service-dependencies>
                <dependency>
                    <class>com.library.services.LoanService</class>
                    <name>loanService</name>
                </dependency>
            </service-dependencies>
        </action>
        <action>
            <path>/admin/approve.do</path>
            <type>com.library.web.controller.actions.ApproveLoanAction</type>
            <form-name>approveLoanForm</form-name>
            <validate>false</validate>
            <service-dependencies>
                <dependency>
                    <class>com.library.services.LoanService</class>
                    <name>loanService</name>
                </dependency>
            </service-dependencies>
        </action>
        <action>
            <path>/admin/activeBookLoans</path>
            <type>com.library.web.controller.actions.ShowActiveBookLoansAction</type>
            <form-name>activeBookLoansForm</form-name>
            <validate>false</validate>
            <service-dependencies>
                <dependency>
                    <class>com.library.services.LoanService</class>
                    <name>loanService</name>
                </dependency>
            </service-dependencies>
        </action>
        <action>
            <path>/admin/activeLoans</path>
            <type>com.library.web.controller.actions.ShowActiveLoansAction</type>
            <service-dependencies>
                <dependency>
                    <class>com.library.services.LoanService</class>
                    <name>loanService</name>
                </dependency>
            </service-dependencies>
        </action>
        <action>
            <path>/changeLanguage</path>
            <type>com.library.web.controller.actions.ChangeLanguageAction</type>
        </action>
    </action-mappings>

    <!--
    Mapping between web page files and its names.
    <entry> - one mapping
        <key> - web page's name
        <value> - web page's file
    -->
    <forwards>
        <entry>
            <key>ShowTitlePage</key>
            <value>/WEB-INF/jsp/titlePage.jsp</value>
        </entry>
        <entry>
            <key>ShowLoginPage</key>
            <value>/WEB-INF/jsp/login.jsp</value>
        </entry>
        <entry>
            <key>ShowRegistrationPage</key>
            <value>/WEB-INF/jsp/registration.jsp</value>
        </entry>
        <entry>
            <key>ShowBookSearchPage</key>
            <value>/WEB-INF/jsp/bookSearch.jsp</value>
        </entry>
        <entry>
            <key>ShowUserCabinetPage</key>
            <value>/WEB-INF/jsp/userCabinet.jsp</value>
        </entry>
        <entry>
            <key>ShowAdminCabinetPage</key>
            <value>/WEB-INF/jsp/adminCabinet.jsp</value>
        </entry>
        <entry>
            <key>ShowPersonalCabinetAction</key>
            <value>/cabinet</value>
        </entry>
        <entry>
            <key>showUnapprovedLoans</key>
            <value>/WEB-INF/jsp/unapprovedLoans.jsp</value>
        </entry>
        <entry>
            <key>ShowUnapprovedLoansAction</key>
            <value>/admin/unapprovedLoans</value>
        </entry>
        <entry>
            <key>showActiveBookLoansPage</key>
            <value>/WEB-INF/jsp/activeBookLoans.jsp</value>
        </entry>
        <entry>
            <key>showActiveLoansPage</key>
            <value>/WEB-INF/jsp/activeLoans.jsp</value>
        </entry>
        <entry>
            <key>ShowAccessDeniedPage</key>
            <value>/WEB-INF/jsp/accessDenied.jsp</value>
        </entry>
        <entry>
            <key>successPage</key>
            <value>/WEB-INF/jsp/successfulRedirect.jsp</value>
        </entry>
    </forwards>

    <!--
    Contains mapping between constrained resources URL and
    authorized for them roles.
    <resource> - constrained resource
        <url-pattern> - URL pattern to constrained resource
        <role> - role which authorized for visiting
        constrained resource
    -->
    <security-constraint>
        <resource>
            <url-pattern>/user</url-pattern>
            <allowed-roles>
                <role>USER</role>
            </allowed-roles>
        </resource>
        <resource>
            <url-pattern>/admin</url-pattern>
            <allowed-roles>
                <role>ADMINISTRATOR</role>
            </allowed-roles>
        </resource>
        <resource>
            <url-pattern>/cabinet</url-pattern>
            <allowed-roles>
                <role>ADMINISTRATOR</role>
                <role>USER</role>
            </allowed-roles>
        </resource>
    </security-constraint>

</servlet-config>
